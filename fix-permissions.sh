#!/bin/bash

# Quick Fix for 403 Permission Errors
# This script provides exact steps to enable API access

echo "ğŸ”§ QUICK FIX: Enable API Permissions"
echo "====================================="
echo ""
echo "âŒ ISSUE: Your new content types are returning 403 Forbidden errors"
echo ""
echo "âœ… SOLUTION: Enable public API access in Strapi admin"
echo ""
echo "ğŸ“‹ STEP-BY-STEP FIX:"
echo ""
echo "1ï¸âƒ£ Open Strapi Admin:"
echo "   ğŸŒ Go to: http://localhost:1337/admin"
echo "   ğŸ” Login with your admin account"
echo ""
echo "2ï¸âƒ£ Navigate to Permissions:"
echo "   âš™ï¸  Settings (left sidebar)"
echo "   ğŸ‘¥ Users & Permissions plugin" 
echo "   ğŸ·ï¸  Roles"
echo "   ğŸŒ Click 'Public' role"
echo ""
echo "3ï¸âƒ£ Enable API Access for New Content Types:"
echo "   ğŸ“‹ Health-topic:"
echo "      âœ… find"
echo "      âœ… findOne"
echo ""
echo "   ğŸ” Symptom:"
echo "      âœ… find" 
echo "      âœ… findOne"
echo ""
echo "   ğŸ’Š Treatment:"
echo "      âœ… find"
echo "      âœ… findOne"
echo ""
echo "4ï¸âƒ£ Save Changes:"
echo "   ğŸ’¾ Click 'Save' button (top right)"
echo "   â³ Wait for confirmation message"
echo ""
echo "5ï¸âƒ£ Test the Fix:"
echo "   ğŸ§ª Run: ./test-api-fixed.sh"
echo "   âœ… All content types should now return 200 OK"
echo ""
echo "ğŸ’¡ WHY THIS IS NEEDED:"
echo "By default, Strapi requires authentication for all API endpoints."
echo "Since you want your health content to be publicly accessible"
echo "(for your website/app), we need to enable public access."
echo ""
echo "ğŸ”’ SECURITY NOTE:"
echo "This only enables READ access (find/findOne)."
echo "Create/Update/Delete still require authentication."
echo ""
echo "ğŸ¯ EXPECTED RESULT AFTER FIX:"
echo "   âœ… Health Topics: 200 OK (instead of 403)"
echo "   âœ… Symptoms: 200 OK (instead of 403)" 
echo "   âœ… Treatments: 200 OK (instead of 403)"
echo "   âœ… Articles: 200 OK (already working)"
echo "   âœ… Conditions: 200 OK (already working)"
echo ""
echo "ğŸš€ Ready to proceed? Press Ctrl+C to exit, or Enter to continue..."
read -p ""
echo ""
echo "âœ… After completing the above steps, run:"
echo "   ./test-api-fixed.sh"
echo ""
echo "Then you can add content using:"
echo "   ./add-new-content-types.sh"
echo ""